#!/bin/sh

returncode=0

unittest() {
	echo "$1"
	act=$2
	expected=$3
	result=$(eval $act)
	test "$result" = "$expected"
	if [ "$?" -ne 0 ]; then
		echo Failed
		echo running "$act"
		echo "$result"
		echo not equals to
		echo "$expected"
		returncode=1
	else
		echo Succeeded
	fi
}

unittest 'Test with first key found in file' \
	'java -cp ../target/bast1aan-pgpreader-0.1.jar:../target/lib/* bast1aan.pgpreader.PgpreaderKt 098524E9D8B9E4784815D03893A6CDA119F3D46B-s.pgp' \
	"$(cat <<EOF
D: 2953214534099831233468172251709729693140781128769731259083593765597038617727582946575630304871787887458987498649521
X: 6011359670476483263763696498946898146772941845867241162132430412362154557903356565375554682308211979414897284118563
Y: 18758633579520347915538325092337410186626794937555116898570817110952196638885254741104046120613877302623198186516734
9133030201184667338
EOF
)"

unittest 'Test with specific key fingerprint' \
	'java -cp ../target/bast1aan-pgpreader-0.1.jar:../target/lib/* bast1aan.pgpreader.PgpreaderKt 098524E9D8B9E4784815D03893A6CDA119F3D46B-s.pgp 098524E9D8B9E4784815D03893A6CDA119F3D46B' \
	"$(cat <<EOF
D: 12212723214394456555912720774535553362988489207576939426616419080057356857364384833209078913442030085862336966251499
X: 38266651888488916043144894390644464895532155759084876338949721180159799863722402531601440069755737939609957898238714
Y: 8737580512645949474252913227206704801513338814387545962177319703095578650776202089087572323190622020437370595634129
-7807326812191337365
EOF
)"

unittest 'Test with encryption key' \
	'java -cp ../target/bast1aan-pgpreader-0.1.jar:../target/lib/* bast1aan.pgpreader.PgpreaderKt CED6B4BD6FBA923A3F44211A9FD35790E68929CD-e.pgp CED6B4BD6FBA923A3F44211A9FD35790E68929CD' \
	"$(cat <<EOF
D: 17879945244975635690828938048372298519706592865197946479644104422081875424542907227669090043930977184201056119569585
X: 6207053911940123132878643827658806842711866308099387204312275471919260796287697331004837157174982807176942165368741
Y: 13890429903248027274406052217247859739003067449673008848959654200639817239405189463439867410817722987826457424473655
-6930099121738405427
EOF
)"


exit $returncode
